function Editor(fileOpener,bus,filesaver){
    var self = this;
    var currentDocument;

    this.selectEditor = function(path) {
        self.documents.forEach(function (d) { 
                d.selected = d.path == path;
                if(d.selected){
                    currentDocument = d;
                    bus("DocumentSelected").broadcast(d);
                }
            });
    }

    bus("SaveCurrentDocument").subscribe(function(doc){
        filesaver(doc.path,doc.content);
    });

    bus("FileSelected").subscribe(function (file) {
        if (!self.documents.some(function (d) { return d.path === file })) {
            var doc = fileOpener(file);
            self.documents.push(doc);
            bus("DocumentLoaded").broadcast(doc);
       }
        self.selectEditor(file);
    });
   
    this.documents = [];
}

module.exports = Editor;